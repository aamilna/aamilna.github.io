<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AaMilNa ‚Ä¢ Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;1,600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#fff7f0;color:#4a3b47;overflow-x:hidden;}

/* üå∏ Background Bubbles */
.bubble-bg{position:fixed;inset:0;z-index:-1;overflow:hidden;}
.bubble{position:absolute;width:260px;height:260px;border-radius:50%;
background:radial-gradient(circle at top left,rgba(255,255,255,0.9),rgba(255,220,230,0.45),rgba(200,150,170,0.25));
animation:float 30s infinite ease-in-out;}
.bubble::after{content:"üå∏";position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:70px;opacity:0.35;}
.bubble:nth-child(1){top:10%;left:6%;animation-duration:30s;}
.bubble:nth-child(2){top:55%;left:72%;animation-duration:36s;}
.bubble:nth-child(3){top:30%;left:42%;animation-duration:42s;}
@keyframes float{0%{transform:translateY(0);}50%{transform:translateY(-60px);}100%{transform:translateY(0);}}

/* Header */
header{
  padding:26px 50px;
  background:rgba(255,255,255,0.85);
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{font-family:'Playfair Display',serif;font-style:italic;}
header a{text-decoration:none;font-weight:500;color:#4a3b47;}
header a:hover{text-decoration:underline;}

/* Shop Grid */
.shop{max-width:1200px;margin:20px auto 80px;padding:0 30px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:30px;}
.card{
  background:white;
  padding:22px;
  border-radius:26px;
  box-shadow:0 18px 40px rgba(0,0,0,0.12);
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  cursor:pointer;
  transition:0.3s;
}
.card:hover{transform:translateY(-5px);}

/* Gallery */
.gallery-container{
  position:relative;
  width:100%;
  aspect-ratio: 16/9;
  margin-bottom:10px;
  overflow:hidden;
  border-radius:18px;
  touch-action: pan-y;
}
.gallery-container img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:18px;
  user-select:none;
}
.gallery-btn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(255,255,255,0.7);
  border:none;
  font-size:18px;
  padding:4px 10px;
  cursor:pointer;
  border-radius:12px;
  user-select:none;
  z-index:2;
}
.gallery-btn:hover{background:rgba(255,255,255,0.9);}
.gallery-btn.prev{left:10px;}
.gallery-btn.next{right:10px;}

/* Heart & Likes */
.likes-container{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}
.heart-btn{
  font-size:20px;
  background:none;
  border:none;
  cursor:pointer;
  color:#ccc;
  transition: transform 0.3s, color 0.3s;
}
.heart-btn.liked{
  color:#e74c3c;
  transform: scale(1.3);
  animation:pop 0.3s forwards;
}
@keyframes pop{
  0%{transform:scale(1);}
  50%{transform:scale(1.5);}
  100%{transform:scale(1.3);}
}
.likes-count{
  font-size:14px;
  font-weight:500;
  color:#4a3b47;
}

/* Product Info */
.card h4{margin-bottom:6px;}
.card p{font-size:14px;opacity:.85;margin-bottom:4px;}
.card button.add-cart{
  margin-top:10px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:14px;
  background:#e7b7c8;
  cursor:pointer;
  font-weight:500;
  transition:.3s;
}
.card button.add-cart:hover{background:#dca6b9;}

/* Toast */
#toast{
  position:fixed;
  bottom:25px;
  left:50%;
  transform:translateX(-50%);
  background:#e7b7c8;
  padding:12px 22px;
  border-radius:20px;
  color:#4a3b47;
  font-weight:500;
  display:none;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
  z-index:1000;
}
</style>
</head>

<body>

<div class="bubble-bg">
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
</div>

<header>
  <h1>Shop</h1>
  <a href="cart.html" aria-label="View Cart">üõí Cart</a>
</header>

<section class="shop">
  <div class="grid" id="shopGrid"></div>
</section>

<div id="toast">Added to cart</div>

<script>
// --- GET PRODUCTS ---
let allProducts = JSON.parse(localStorage.getItem("allProducts")) || [];

// Ensure unique IDs
allProducts.forEach((p, idx)=>{ if(!p.id) p.id = 'prod_'+idx; });

// Filter approved products, fallback to all if none match
let approvedProducts = allProducts.filter(p => p.statusAdmin === "Approved");
if(approvedProducts.length === 0) approvedProducts = allProducts;

// Initialize likes
approvedProducts.forEach(p => { if(p.likes === undefined) p.likes = 0; if(p.liked === undefined) p.liked = false; });

// --- SHOW TOAST ---
function showToast(msg){
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.style.display='block';
  setTimeout(()=>{ toast.style.display='none'; },1200);
}

// --- RENDER SHOP ---
function renderShop(){
  const grid = document.getElementById("shopGrid");
  grid.innerHTML = "";

  approvedProducts.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";

    let currentIndex = 0;
    const images = (p.images && p.images.length) ? p.images : ["https://via.placeholder.com/300x190?text=No+Image"];

    card.innerHTML = `
      <div class="gallery-container">
        <img src="${images[0]}" alt="Image of ${p.name}">
        ${images.length>1 ? '<button class="gallery-btn prev">&#10094;</button><button class="gallery-btn next">&#10095;</button>' : ''}
      </div>
      <div class="likes-container">
        <button class="heart-btn ${p.liked?'liked':''}" aria-pressed="${p.liked?'true':'false'}">‚ù§Ô∏è</button>
        <span class="likes-count">${p.likes}</span>
      </div>
      <h4>${p.name}</h4>
      <p>PKR ${Number(p.price).toLocaleString()}</p>
      <p>By ${p.artisanName || "Unknown Artisan"}</p>
      <button class="add-cart">Add to Cart</button>
    `;

    const galleryImg = card.querySelector(".gallery-container img");
    const prevBtn = card.querySelector(".gallery-btn.prev");
    const nextBtn = card.querySelector(".gallery-btn.next");
    const addCartBtn = card.querySelector(".add-cart");
    const heartBtn = card.querySelector(".heart-btn");
    const count = card.querySelector(".likes-count");

    // --- Gallery Navigation ---
    if(images.length > 1){
      prevBtn.onclick = e => { e.stopPropagation(); currentIndex=(currentIndex-1+images.length)%images.length; galleryImg.src=images[currentIndex]; };
      nextBtn.onclick = e => { e.stopPropagation(); currentIndex=(currentIndex+1)%images.length; galleryImg.src=images[currentIndex]; };
    }

    // --- Touch Swipe ---
    let startX=0, startY=0;
    galleryImg.addEventListener("touchstart", e => { startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
    galleryImg.addEventListener("touchend", e => {
      const diffX = e.changedTouches[0].clientX - startX;
      const diffY = e.changedTouches[0].clientY - startY;
      if(Math.abs(diffX)>40 && Math.abs(diffX)>Math.abs(diffY)){
        currentIndex = diffX>0 ? (currentIndex-1+images.length)%images.length : (currentIndex+1)%images.length;
        galleryImg.src=images[currentIndex];
      }
    });

    // --- Heart Like ---
    heartBtn.onclick = e => {
      e.stopPropagation();
      if(heartBtn.classList.contains("liked")){
        heartBtn.classList.remove("liked");
        heartBtn.setAttribute("aria-pressed","false");
        p.likes = Math.max(0,p.likes-1);
        p.liked=false;
      } else {
        heartBtn.classList.add("liked");
        heartBtn.setAttribute("aria-pressed","true");
        p.likes+=1;
        p.liked=true;
      }
      count.textContent = p.likes;

      const updatedProducts = JSON.parse(localStorage.getItem("allProducts")) || [];
      updatedProducts.forEach(ap => { if(ap.id===p.id){ ap.likes=p.likes; ap.liked=p.liked; } });
      localStorage.setItem("allProducts", JSON.stringify(updatedProducts));
    };

    // --- Add to Cart ---
    addCartBtn.onclick = e => {
      e.stopPropagation();
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(i=>i.id===p.id);
      if(existing){ existing.qty+=1; }
      else{ cart.push({ id:p.id, name:p.name, price:p.price, image:images[0], artisanName:p.artisanName, qty:1 }); }
      localStorage.setItem("cart", JSON.stringify(cart));
      showToast("Added to cart");
    };

    // --- Click to Product Page ---
    card.onclick = () => {
      localStorage.setItem("currentProduct", JSON.stringify(p));
      window.location.href = "product.html";
    };

    grid.appendChild(card);
  });
}

// --- INIT ---
renderShop();
</script>

</body>
</html>






















